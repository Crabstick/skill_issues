<!DOCTYPE HTML>
<html lang="en-US">
    <head prefix="og: http://ogp.me/ns# book: http://ogp.me/ns/book#">
        
        <meta charset="UTF-8">
        <title>springmvc | Skill_issues</title>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="robots" content="index, follow">
        <meta name="author" content="duoduo369">
        <meta name="description" content="Book generated using GitBook">
        <meta name="keywords" content="gitbook,github" >
        <meta name="generator" content="www.gitbook.io">

        
        
        <link rel="prev" href="../skill/oauth.issue.html" />
        

        <meta property="og:title" content="springmvc | Skill_issues">
        <meta property="og:site_name" content="Skill_issues">
        <meta property="og:type" content="book">
        <meta property="og:locale" content="en_US">

        <meta property="book:author" content="https://github.com/duoduo369">
        <meta property="book:tag" content="GitBook">

        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">

        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

        
        <link rel="stylesheet" href="../gitbook/style.css">
        
        
    </head>
    <body>
        
<div class="book" data-github="duoduo369/skill_issues" data-level="5.4">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="https://github.com/duoduo369/skill_issues" target="_blank" class="btn pull-left"><i class="fa fa-github-alt"></i></a>
    <a href="#" class="btn pull-left toggle-summary"><i class="fa fa-align-justify"></i></a>

    <!-- Actions Right -->
    <a href="#" target="_blank" class="btn pull-right" data-sharing="google-plus"><i class="fa fa-google-plus"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="facebook"><i class="fa fa-facebook"></i></a>
    <a href="#" target="_blank" class="btn pull-right" data-sharing="twitter"><i class="fa fa-twitter"></i></a>

    <a href="https://github.com/duoduo369/skill_issues/stargazers" target="_blank" class="btn pull-right count-star"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/duoduo369/skill_issues/watchers" target="_blank" class="btn pull-right count-watch"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>


    <!-- Title -->
    <h1><a href="../README.html" >Skill_issues</a></h1>
</div>

    <div class="book-summary">
    <ul class="summary">
        <li>
            <a href="https://github.com/duoduo369" target="blank">About the author</a>
        </li>
        <li>
            <a href="https://github.com/duoduo369/skill_issues/issues" target="blank">Questions and Issues</a>
        </li>
        <li>
            <a href="https://github.com/duoduo369/skill_issues/edit/master/skill/springmvc.issue.md" target="blank">Edit and Contribute</a>
        </li>
        <li class="divider"></li>
        <li data-level="0">
            <a href="../README.html"><i class="fa fa-check"></i> Introduction</a>
        </li>
        
            <li  data-level="1">
                
                <a href="../front/README.html">
                    <i class="fa fa-check"></i> <b>1)</b> 前端
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="1.1">
                            
                            <a href="../front/angularjs.issue.html">
                                <i class="fa fa-check"></i> <b>1.1)</b> angularjs
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.2">
                            
                            <a href="../front/js.issue.html">
                                <i class="fa fa-check"></i> <b>1.2)</b> js
                            </a>
                            
                        </li>
                    
                        <li  data-level="1.3">
                            
                            <a href="../front/css.issue.html">
                                <i class="fa fa-check"></i> <b>1.3)</b> css
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="2">
                
                <a href="../python/README.html">
                    <i class="fa fa-check"></i> <b>2)</b> python
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="2.1">
                            
                            <a href="../python/python.issue.html">
                                <i class="fa fa-check"></i> <b>2.1)</b> python
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.2">
                            
                            <a href="../python/django.issue.html">
                                <i class="fa fa-check"></i> <b>2.2)</b> django
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.3">
                            
                            <a href="../python/scrapy.issue.html">
                                <i class="fa fa-check"></i> <b>2.3)</b> scrapy
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.4">
                            
                            <a href="../python/pythonchallenge.issue.html">
                                <i class="fa fa-check"></i> <b>2.4)</b> pythonchallenge
                            </a>
                            
                        </li>
                    
                        <li  data-level="2.5">
                            
                            <a href="../python/zarkpy.issue.html">
                                <i class="fa fa-check"></i> <b>2.5)</b> zarkpy
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="3">
                
                <a href="../git/README.html">
                    <i class="fa fa-check"></i> <b>3)</b> git
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="3.1">
                            
                            <a href="../git/git.issue.html">
                                <i class="fa fa-check"></i> <b>3.1)</b> git
                            </a>
                            
                        </li>
                    
                        <li  data-level="3.2">
                            
                            <a href="../git/gitbook.issue.html">
                                <i class="fa fa-check"></i> <b>3.2)</b> gitbook
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="4">
                
                <a href="../tools/README.html">
                    <i class="fa fa-check"></i> <b>4)</b> tools
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="4.1">
                            
                            <a href="../tools/vim.issue.html">
                                <i class="fa fa-check"></i> <b>4.1)</b> vim
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.2">
                            
                            <a href="../tools/build.issue.html">
                                <i class="fa fa-check"></i> <b>4.2)</b> build
                            </a>
                            
                        </li>
                    
                        <li  data-level="4.3">
                            
                            <a href="../tools/heroku.issue.html">
                                <i class="fa fa-check"></i> <b>4.3)</b> heroku
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
            <li  data-level="5">
                
                <a href="../skill/README.html">
                    <i class="fa fa-check"></i> <b>5)</b> skill
                </a>
                
                
                <ul class="articles">
                    
                        <li  data-level="5.1">
                            
                            <a href="../skill/linux.issue.html">
                                <i class="fa fa-check"></i> <b>5.1)</b> linux
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.2">
                            
                            <a href="../skill/nginx.issue.html">
                                <i class="fa fa-check"></i> <b>5.2)</b> nginx
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.3">
                            
                            <a href="../skill/oauth.issue.html">
                                <i class="fa fa-check"></i> <b>5.3)</b> oauth
                            </a>
                            
                        </li>
                    
                        <li  data-level="5.4">
                            
                            <a href="../skill/springmvc.issue.html">
                                <i class="fa fa-check"></i> <b>5.4)</b> springmvc
                            </a>
                            
                        </li>
                    
                </ul>
                
            </li>
        
    </ul>
</div>

    <div class="book-body" tabindex="-1">
        <div class="page-wrapper">
            <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 100%;min-width: 95.45454545454545%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../README.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../front/README.html" title="前端" class="chapter done new-chapter" data-progress="1" style="left: 4.545454545454546%;"></a>
    
        <a href="../front/angularjs.issue.html" title="angularjs" class="chapter done " data-progress="1.1" style="left: 9.090909090909092%;"></a>
    
        <a href="../front/js.issue.html" title="js" class="chapter done " data-progress="1.2" style="left: 13.636363636363637%;"></a>
    
        <a href="../front/css.issue.html" title="css" class="chapter done " data-progress="1.3" style="left: 18.181818181818183%;"></a>
    
        <a href="../python/README.html" title="python" class="chapter done new-chapter" data-progress="2" style="left: 22.727272727272727%;"></a>
    
        <a href="../python/python.issue.html" title="python" class="chapter done " data-progress="2.1" style="left: 27.272727272727273%;"></a>
    
        <a href="../python/django.issue.html" title="django" class="chapter done " data-progress="2.2" style="left: 31.818181818181817%;"></a>
    
        <a href="../python/scrapy.issue.html" title="scrapy" class="chapter done " data-progress="2.3" style="left: 36.36363636363637%;"></a>
    
        <a href="../python/pythonchallenge.issue.html" title="pythonchallenge" class="chapter done " data-progress="2.4" style="left: 40.90909090909091%;"></a>
    
        <a href="../python/zarkpy.issue.html" title="zarkpy" class="chapter done " data-progress="2.5" style="left: 45.45454545454545%;"></a>
    
        <a href="../git/README.html" title="git" class="chapter done new-chapter" data-progress="3" style="left: 50%;"></a>
    
        <a href="../git/git.issue.html" title="git" class="chapter done " data-progress="3.1" style="left: 54.54545454545455%;"></a>
    
        <a href="../git/gitbook.issue.html" title="gitbook" class="chapter done " data-progress="3.2" style="left: 59.09090909090909%;"></a>
    
        <a href="../tools/README.html" title="tools" class="chapter done new-chapter" data-progress="4" style="left: 63.63636363636363%;"></a>
    
        <a href="../tools/vim.issue.html" title="vim" class="chapter done " data-progress="4.1" style="left: 68.18181818181819%;"></a>
    
        <a href="../tools/build.issue.html" title="build" class="chapter done " data-progress="4.2" style="left: 72.72727272727273%;"></a>
    
        <a href="../tools/heroku.issue.html" title="heroku" class="chapter done " data-progress="4.3" style="left: 77.27272727272727%;"></a>
    
        <a href="../skill/README.html" title="skill" class="chapter done new-chapter" data-progress="5" style="left: 81.81818181818181%;"></a>
    
        <a href="../skill/linux.issue.html" title="linux" class="chapter done " data-progress="5.1" style="left: 86.36363636363636%;"></a>
    
        <a href="../skill/nginx.issue.html" title="nginx" class="chapter done " data-progress="5.2" style="left: 90.9090909090909%;"></a>
    
        <a href="../skill/oauth.issue.html" title="oauth" class="chapter done " data-progress="5.3" style="left: 95.45454545454545%;"></a>
    
        <a href="../skill/springmvc.issue.html" title="springmvc" class="chapter done " data-progress="5.4" style="left: 100%;"></a>
    
    </div>
</div>

            <div class="page-inner">
            
                <section class="normal" id="section-gitbook_19">
                
                    <p>spring mvc 相关</p>
<h2 id="spring-mvc-json-">spring mvc json使用</h2>
<h3 id="-jackson-all-jar-1-9-1-">导入 参照一下连接注意，Jackson 需要用all的jar包，并且版本要在1.9.1以上</h3>
<p><a href="http://www.mkyong.com/spring-mvc/spring-3-mvc-and-json-example/" target="_blank">http://www.mkyong.com/spring-mvc/spring-3-mvc-and-json-example/</a></p>
<pre><code>@RequestMapping(<span class="hljs-keyword">value</span> = <span class="hljs-string">"test/user/json"</span>, method = RequestMethod.GET)
<span class="hljs-keyword">public</span> @ResponseBody User <span class="hljs-title">getJson</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(<span class="hljs-string">"name"</span>, <span class="hljs-string">"password"</span>, <span class="hljs-string">"login"</span>);
}
</code></pre><ol>
<li><p>Jackson library is existed in the project classpath</p>
<p>2.The mvc:annotation-driven is enabled</p>
</li>
<li><p>Return method annotated with @ResponseBody</p>
</li>
</ol>
<h2 id="spring-mvc-freemarker-">spring mvc + freemarker中表单组件 </h2>
<p>定义一个form.ftl宏，restful风格的uri中需要添加_method这个hidden input,内容分别为put（修改），delete（删除），post(新加)
如果用@s.formXXX Controller中必须有绑定的对象，在这个例子里必须有User 对象，可以new，可以传参。</p>
<pre><code>&lt;#macro userform action method=<span class="hljs-string">"post"</span> button_content=<span class="hljs-string">"注册新用户"</span> &gt;
&lt;form action=${action} method=<span class="hljs-string">"post"</span>&gt;
&lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">"hidden"</span> name=<span class="hljs-string">"_method"</span> value=<span class="hljs-string">"${method}"</span>&gt;
&lt;#<span class="hljs-keyword">if</span> method!=<span class="hljs-string">'delete'</span>&gt;
    &lt;#<span class="hljs-keyword">import</span> <span class="hljs-string">"/spring.ftl"</span> as s /&gt;   
    &lt;<span class="hljs-annotation">@s</span>.formHiddenInput <span class="hljs-string">"user.uuser_id"</span>/&gt;
    &lt;<span class="hljs-annotation">@s</span>.showErrors <span class="hljs-string">"&lt;div&gt;"</span> /&gt;
    登录名:
    &lt;<span class="hljs-annotation">@s</span>.formInput <span class="hljs-string">"user.login_name"</span> <span class="hljs-string">"class='loginText'"</span>/&gt;
    &lt;<span class="hljs-annotation">@s</span>.showErrors <span class="hljs-string">"&lt;div&gt;"</span> /&gt;
     用户名:
    &lt;<span class="hljs-annotation">@s</span>.formInput <span class="hljs-string">"user.user_name"</span> /&gt;
    &lt;<span class="hljs-annotation">@s</span>.showErrors <span class="hljs-string">"&lt;div&gt;"</span> /&gt;
    密码：
    &lt;<span class="hljs-annotation">@s</span>.formPasswordInput <span class="hljs-string">"user.password"</span>/&gt;
    &lt;<span class="hljs-annotation">@s</span>.showErrors <span class="hljs-string">"&lt;div&gt;"</span> /&gt;
  &lt;button <span class="hljs-keyword">type</span>=<span class="hljs-string">"submit"</span>&gt;${button_content}&lt;/button&gt;
&lt;#<span class="hljs-keyword">else</span>&gt;
    &lt;#nested&gt;
&lt;/#<span class="hljs-keyword">if</span>&gt;
&lt;/form&gt;
 &lt;/#macro&gt; 
</code></pre><p>对应文件引用即可</p>
<pre><code>新增post
<span class="hljs-tag">&lt;<span class="hljs-title">#import</span> "<span class="hljs-attribute">form.ftl</span>" <span class="hljs-attribute">as</span> <span class="hljs-attribute">form</span>/&gt;</span>
<span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://www.w3.org/1999/xhtml"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>
        form
    <span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-title">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">@form.userform</span> <span class="hljs-attribute">action</span>=<span class="hljs-value">"post"</span> <span class="hljs-attribute">button_content</span>=<span class="hljs-value">"注册新用户"</span>/&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
</code></pre><p></html></p>
<pre><code>删除代码段
&lt;<span class="hljs-variable">@form</span>.userform action=<span class="hljs-string">"<span class="hljs-subst">${webRoot}</span>/user/delete/<span class="hljs-subst">${user.uuser_id}</span>"</span> method=<span class="hljs-string">"delete"</span> button_content=<span class="hljs-string">"修改"</span>&gt;
     &lt;button  fx=<span class="hljs-string">"confirm[msg=你确定删除?]"</span> type=<span class="hljs-string">"submit"</span>&gt;删除&lt;<span class="hljs-regexp">/button&gt;
 &lt;/</span><span class="hljs-variable">@form</span>.userform&gt;

修改代码段
&lt;<span class="hljs-variable">@form</span>.userform action=<span class="hljs-string">"/user/put/<span class="hljs-subst">${user.uuser_id}</span>"</span> method=<span class="hljs-string">"put"</span> button_content=<span class="hljs-string">"修改"</span>/&gt;
</code></pre><h2 id="spring-mvc-junit-">spring mvc + junit单元测试 </h2>
<h3 id="-spring-spring-ioc-">测试中导入spring中的配置文件，并且使用注解还是比较简单的，类上面加上两个注解即可，测试类内部就可以使用spring的IoC了。</h3>
<pre><code><span class="hljs-annotation">@RunWith</span>(SpringJUnit4ClassRunner.class)
<span class="hljs-annotation">@ContextConfiguration</span>(locations = { <span class="hljs-string">"/springMVC.xml"</span> })
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TestEhcache</span> {</span>
    <span class="hljs-annotation">@Resource</span>(name = <span class="hljs-string">"cacheUserController"</span>)
    <span class="hljs-keyword">private</span> UserController controller;
    <span class="hljs-annotation">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">test</span>(){   .....   }

    .....
    .....
}
</code></pre><h3 id="spring-controller-tomcat-">spring 测试controller，测试页面再也不用启动tomcat了以及写一堆没用的页面了～</h3>
<p>spring测试controller的时候使用的是Mock这个测试框架 ，Mock的request和response分别使用：MockHttpServletRequest request; MockHttpServletResponse response。注意测试的时候需要模拟真实的HTTP请求，即每次的request和response对象都是一个新new的。</p>
<pre><code><span class="hljs-built_in">request</span>.setRequestURI(<span class="hljs-string">"/cacheTest/get/2"</span>);
<span class="hljs-built_in">request</span>.setMethod(HttpMethod.<span class="hljs-keyword">GET</span>.name());
<span class="hljs-keyword">new</span> AnnotationMethodHandlerAdapter().handle(<span class="hljs-built_in">request</span>, <span class="hljs-built_in">response</span>,
                controller);
</code></pre><p>直接上例子：</p>
<pre><code><span class="hljs-comment">/**
 * Project Name:justforfun
 * File Name:TestEhcache.java
 * Package Name:com.practice.ehcache
 * Copyright (c) 2013, Thirdtiger.com All Rights Reserved.
 *
 */</span>
package <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.practice</span><span class="hljs-preprocessor">.ehcache</span><span class="hljs-comment">;</span>

import javax<span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.Resource</span><span class="hljs-comment">;</span>

import org<span class="hljs-preprocessor">.junit</span><span class="hljs-preprocessor">.Assert</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.junit</span><span class="hljs-preprocessor">.BeforeClass</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.junit</span><span class="hljs-preprocessor">.Test</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.junit</span><span class="hljs-preprocessor">.runner</span><span class="hljs-preprocessor">.RunWith</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.http</span><span class="hljs-preprocessor">.HttpMethod</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.mock</span><span class="hljs-preprocessor">.web</span><span class="hljs-preprocessor">.MockHttpServletRequest</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.mock</span><span class="hljs-preprocessor">.web</span><span class="hljs-preprocessor">.MockHttpServletResponse</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.test</span><span class="hljs-preprocessor">.context</span><span class="hljs-preprocessor">.ContextConfiguration</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.test</span><span class="hljs-preprocessor">.context</span><span class="hljs-preprocessor">.junit</span>4<span class="hljs-preprocessor">.SpringJUnit</span>4ClassRunner<span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.ui</span><span class="hljs-preprocessor">.Model</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.web</span><span class="hljs-preprocessor">.method</span><span class="hljs-preprocessor">.HandlerMethod</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.web</span><span class="hljs-preprocessor">.servlet</span><span class="hljs-preprocessor">.ModelAndView</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.web</span><span class="hljs-preprocessor">.servlet</span><span class="hljs-preprocessor">.mvc</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.AnnotationMethodHandlerAdapter</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.web</span><span class="hljs-preprocessor">.servlet</span><span class="hljs-preprocessor">.mvc</span><span class="hljs-preprocessor">.method</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.RequestMappingHandlerAdapter</span><span class="hljs-comment">;</span>

<span class="hljs-comment">/**
 * com.practice.ehcache.TestEhcache TODO:
 * 
 * @author: 杨洋 Contributor：TODO
 * @since JDK 1.6 2013年11月1日 上午9:36:25
 */</span>
@RunWith(SpringJUnit4ClassRunner<span class="hljs-preprocessor">.class</span>)
@ContextConfiguration(locations = { <span class="hljs-string">"/springMVC.xml"</span> })
public class TestEhcache {
    @Resource(name = <span class="hljs-string">"cacheUserController"</span>)
    private UserController controller<span class="hljs-comment">;</span>
    @Resource
    public RequestMappingHandlerAdapter handlerAdapter<span class="hljs-comment">;</span>
    private static MockHttpServletRequest request<span class="hljs-comment">;</span>
    private static MockHttpServletResponse response<span class="hljs-comment">;</span>

    private void init() {
        request = new MockHttpServletRequest()<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setCharacterEncoding</span>(<span class="hljs-string">"UTF-8"</span>)<span class="hljs-comment">;</span>
        response = new MockHttpServletResponse()<span class="hljs-comment">;</span>
    }

    @Test
    public void testCache() throws Exception {
        init()<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setRequestURI</span>(<span class="hljs-string">"/cacheTest/get/2"</span>)<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setMethod</span>(HttpMethod<span class="hljs-preprocessor">.GET</span><span class="hljs-preprocessor">.name</span>())<span class="hljs-comment">;</span>
        new AnnotationMethodHandlerAdapter()<span class="hljs-preprocessor">.handle</span>(request, response,
                controller)<span class="hljs-comment">;</span>
        init()<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setRequestURI</span>(<span class="hljs-string">"/cacheTest/get/2"</span>)<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setMethod</span>(HttpMethod<span class="hljs-preprocessor">.GET</span><span class="hljs-preprocessor">.name</span>())<span class="hljs-comment">;</span>
        new AnnotationMethodHandlerAdapter()<span class="hljs-preprocessor">.handle</span>(request, response,
                controller)<span class="hljs-comment">;</span>
        // handlerAdapter<span class="hljs-preprocessor">.handle</span>(request, response, new
        // HandlerMethod(controller,
        // <span class="hljs-string">"get"</span>, String<span class="hljs-preprocessor">.class</span>, Model<span class="hljs-preprocessor">.class</span>))<span class="hljs-comment">; // 执行URI对应的action</span>
        Assert<span class="hljs-preprocessor">.assertEquals</span>(response<span class="hljs-preprocessor">.getStatus</span>(), <span class="hljs-number">200</span>)<span class="hljs-comment">;</span>
        // Assert logic
    }

    @Test
    public void testCache2() throws Exception {
        init()<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setRequestURI</span>(<span class="hljs-string">"/cacheTest/get/3"</span>)<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setMethod</span>(HttpMethod<span class="hljs-preprocessor">.GET</span><span class="hljs-preprocessor">.name</span>())<span class="hljs-comment">;</span>
        new AnnotationMethodHandlerAdapter()<span class="hljs-preprocessor">.handle</span>(request, response,
                controller)<span class="hljs-comment">;</span>
        init()<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setRequestURI</span>(<span class="hljs-string">"/cacheTest/get/3"</span>)<span class="hljs-comment">;</span>
        request<span class="hljs-preprocessor">.setMethod</span>(HttpMethod<span class="hljs-preprocessor">.GET</span><span class="hljs-preprocessor">.name</span>())<span class="hljs-comment">;</span>
        new AnnotationMethodHandlerAdapter()<span class="hljs-preprocessor">.handle</span>(request, response,
                controller)<span class="hljs-comment">;</span>
        // handlerAdapter<span class="hljs-preprocessor">.handle</span>(request, response, new
        // HandlerMethod(controller,
        // <span class="hljs-string">"get"</span>, String<span class="hljs-preprocessor">.class</span>, Model<span class="hljs-preprocessor">.class</span>))<span class="hljs-comment">; // 执行URI对应的action</span>
        Assert<span class="hljs-preprocessor">.assertEquals</span>(response<span class="hljs-preprocessor">.getStatus</span>(), <span class="hljs-number">200</span>)<span class="hljs-comment">;</span>
        // Assert logic
    }
}
</code></pre><h2 id="spring-mvc-ehcache-">spring mvc ehcache缓存</h2>
<p>spring mvc使用ehcache</p>
<p>需要用到的jar包</p>
<pre><code>ehcache-<span class="hljs-number">2.7</span><span class="hljs-number">.5</span><span class="hljs-preprocessor">.jar</span>(主程序)
ehcache-spring-annotations-<span class="hljs-number">1.2</span><span class="hljs-number">.0</span><span class="hljs-preprocessor">.jar</span>(注解)
guava-r09<span class="hljs-preprocessor">.jar</span>(依赖)
slf4j-api-<span class="hljs-number">1.6</span><span class="hljs-number">.6</span><span class="hljs-preprocessor">.jar</span>(依赖)
</code></pre><p>spring配置文件中需要添加如下内容</p>
<pre><code>头部
xmlns:cache="http://www.springframework.org/schema/cache"
xsi:schemaLocation
http://www.springframework.org/schema/cache  
http://www.springframework.org/schema/cache/spring-cache-3.2.xsd  

<span class="hljs-comment">&lt;!-- 缓存配置 --&gt;</span>
<span class="hljs-comment">&lt;!-- 启用缓存注解功能(请将其配置在Spring主配置文件中) --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">cache:annotation-driven</span> <span class="hljs-attribute">cache-manager</span>=<span class="hljs-value">"cacheManager"</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- Spring自己的基于java.util.concurrent.ConcurrentHashMap实现的缓存管理器(该功能是从Spring3.1开始提供的) --&gt;</span>
<span class="hljs-comment">&lt;!-- &lt;bean id="cacheManager" class="org.springframework.cache.support.SimpleCacheManager"&gt; 
    &lt;property name="caches"&gt; &lt;set&gt; &lt;bean name="myCache" class="org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean"/&gt; 
    &lt;/set&gt; &lt;/property&gt; &lt;/bean&gt; --&gt;</span>

<span class="hljs-comment">&lt;!-- 若只想使用Spring自身提供的缓存器,则注释掉下面的两个关于Ehcache配置的bean,并启用上面的SimpleCacheManager即可 --&gt;</span>
<span class="hljs-comment">&lt;!-- Spring提供的基于的Ehcache实现的缓存管理器 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"cacheManagerFactory"</span>
    <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"configLocation"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"classpath:ehcache.xml"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">bean</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"cacheManager"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"org.springframework.cache.ehcache.EhCacheCacheManager"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">property</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"cacheManager"</span> <span class="hljs-attribute">ref</span>=<span class="hljs-value">"cacheManagerFactory"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">bean</span>&gt;</span>
</code></pre><p>cache一般用在和数据库交互的地方service</p>
<pre><code>示例
<span class="hljs-comment">/**
 * Project Name:justforfun
 * File Name:NoticeService.java
 * Package Name:com.aft.site.yey.service
 * Copyright (c) 2013, Thirdtiger.com All Rights Reserved.
 *
 */</span>
package <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.aft</span><span class="hljs-preprocessor">.site</span><span class="hljs-preprocessor">.yey</span><span class="hljs-preprocessor">.service</span><span class="hljs-comment">;</span>

import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.Date</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.HashMap</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.LinkedHashMap</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.List</span><span class="hljs-comment">;</span>
import java<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.Map</span><span class="hljs-comment">;</span>

import javax<span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.Resource</span><span class="hljs-comment">;</span>

import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.commons</span><span class="hljs-preprocessor">.logging</span><span class="hljs-preprocessor">.Log</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.apache</span><span class="hljs-preprocessor">.commons</span><span class="hljs-preprocessor">.logging</span><span class="hljs-preprocessor">.LogFactory</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.CacheEvict</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.CachePut</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.cache</span><span class="hljs-preprocessor">.annotation</span><span class="hljs-preprocessor">.Cacheable</span><span class="hljs-comment">;</span>
import org<span class="hljs-preprocessor">.springframework</span><span class="hljs-preprocessor">.stereotype</span><span class="hljs-preprocessor">.Service</span><span class="hljs-comment">;</span>

import <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.aft</span><span class="hljs-preprocessor">.site</span><span class="hljs-preprocessor">.yey</span><span class="hljs-preprocessor">.dao</span><span class="hljs-preprocessor">.NoticeDao</span><span class="hljs-comment">;</span>
import <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.aft</span><span class="hljs-preprocessor">.site</span><span class="hljs-preprocessor">.yey</span><span class="hljs-preprocessor">.entity</span><span class="hljs-preprocessor">.Notice</span><span class="hljs-comment">;</span>
import <span class="hljs-keyword">com</span><span class="hljs-preprocessor">.app</span><span class="hljs-preprocessor">.jdbc</span><span class="hljs-preprocessor">.core</span><span class="hljs-preprocessor">.ToolUtil</span><span class="hljs-comment">;</span>

<span class="hljs-comment">/**
 * com.aft.site.yey.service.NoticeService TODO:
 * 
 * @author: yangyang 2013年10月21日 Contributor：TODO
 * @since JDK 1.6
 */</span>
@Service(<span class="hljs-string">"yeyNoticeService"</span>)
public class NoticeService {
    private static Log logger = LogFactory<span class="hljs-preprocessor">.getLog</span>(NoticeService<span class="hljs-preprocessor">.class</span>)<span class="hljs-comment">;</span>
    @Resource(name = <span class="hljs-string">"yeyNoticeDao"</span>)
    private NoticeDao dao<span class="hljs-comment">;</span>

    <span class="hljs-comment">/**
     * status = 0 指未删除
     * */</span>
    @Cacheable(value = <span class="hljs-string">"cacheTest"</span>,key=<span class="hljs-string">"'noticelist'"</span>)
    public List&lt;Notice&gt; topN(int begin, int end) {
        LinkedHashMap&lt;String, String&gt; orderby = new LinkedHashMap&lt;String, String&gt;()<span class="hljs-comment">;</span>
        orderby<span class="hljs-preprocessor">.put</span>(<span class="hljs-string">"publish_time"</span>, <span class="hljs-string">"desc"</span>)<span class="hljs-comment">;</span>
        Map&lt;String, String&gt; where = new HashMap&lt;String, String&gt;()<span class="hljs-comment">;</span>
        where<span class="hljs-preprocessor">.put</span>(dao<span class="hljs-preprocessor">.STATUS</span> + <span class="hljs-string">" = ? "</span>, dao<span class="hljs-preprocessor">.NORMAL</span>_CODE<span class="hljs-preprocessor">.toString</span>())<span class="hljs-comment">;</span>
        //TODO:delete
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"list:"</span>)<span class="hljs-comment">;</span>
        logger<span class="hljs-preprocessor">.info</span>(<span class="hljs-string">"[list ]"</span>)<span class="hljs-comment">;</span>
        return dao<span class="hljs-preprocessor">.find</span>(where, orderby, begin, end)<span class="hljs-comment">;</span>
    }

    @CacheEvict(value = <span class="hljs-string">"cacheTest"</span>,key=<span class="hljs-string">"'noticelist'"</span>)
    public void delete(String id) {
        //TODO:delete
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"delete:"</span>)<span class="hljs-comment">;</span>
        logger<span class="hljs-preprocessor">.info</span>(<span class="hljs-string">"delete "</span>)<span class="hljs-comment">;</span>
        dao<span class="hljs-preprocessor">.delete</span>(id, false)<span class="hljs-comment">;</span>
    }

    @CacheEvict(value = <span class="hljs-string">"cacheTest"</span>, allEntries = true)
    public void save(Notice notice) {
        notice<span class="hljs-preprocessor">.setRowid</span>(ToolUtil<span class="hljs-preprocessor">.getUUID</span>())<span class="hljs-comment">;</span>
        notice<span class="hljs-preprocessor">.setStatus</span>(dao<span class="hljs-preprocessor">.NORMAL</span>_CODE)<span class="hljs-comment">;</span>
        notice<span class="hljs-preprocessor">.setPublish</span>_time(new Date())<span class="hljs-comment">;</span>
        // TODO:yeyid的获得方式
        notice<span class="hljs-preprocessor">.setYey</span>_id(<span class="hljs-string">"123"</span>)<span class="hljs-comment">;</span>
        dao<span class="hljs-preprocessor">.insert</span>(notice)<span class="hljs-comment">;</span>
        //TODO:delete
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"save:"</span>)<span class="hljs-comment">;</span>
        logger<span class="hljs-preprocessor">.info</span>(<span class="hljs-string">"save "</span>)<span class="hljs-comment">;</span>
    }

    public Notice get(String id) {
        return dao<span class="hljs-preprocessor">.findById</span>(id)<span class="hljs-comment">;</span>
    }

    //@CachePut(value = <span class="hljs-string">"cacheTest"</span>,key=<span class="hljs-string">"#notice.getRowid()"</span>)
    public void update(Notice notice) {
        Map&lt;String, String&gt; <span class="hljs-keyword">set</span> = new HashMap&lt;String, String&gt;()<span class="hljs-comment">;</span>
        LinkedHashMap&lt;String, String&gt; where = new LinkedHashMap&lt;String, String&gt;()<span class="hljs-comment">;</span>
        <span class="hljs-keyword">set</span><span class="hljs-preprocessor">.put</span>(<span class="hljs-string">"title"</span>, notice<span class="hljs-preprocessor">.getTitle</span>())<span class="hljs-comment">;</span>
        <span class="hljs-keyword">set</span><span class="hljs-preprocessor">.put</span>(<span class="hljs-string">"author"</span>, notice<span class="hljs-preprocessor">.getAuthor</span>())<span class="hljs-comment">;</span>
        <span class="hljs-keyword">set</span><span class="hljs-preprocessor">.put</span>(<span class="hljs-string">"content"</span>, notice<span class="hljs-preprocessor">.getContent</span>())<span class="hljs-comment">;</span>
        where<span class="hljs-preprocessor">.put</span>(dao<span class="hljs-preprocessor">.getIdColumnName</span>() + <span class="hljs-string">"=?"</span>, notice<span class="hljs-preprocessor">.getRowid</span>())<span class="hljs-comment">;</span>
        dao<span class="hljs-preprocessor">.update</span>(<span class="hljs-keyword">set</span>, where)<span class="hljs-comment">;</span>
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(<span class="hljs-string">"update:"</span>)<span class="hljs-comment">;</span>
        logger<span class="hljs-preprocessor">.info</span>(<span class="hljs-string">"update "</span>)<span class="hljs-comment">;</span>
    }

}
</code></pre><h3 id="-spring-mvc-cache-">非常详细的spring mvc和cache的使用博客</h3>
<p><a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-spring-cache/" target="_blank">http://www.ibm.com/developerworks/cn/opensource/os-cn-spring-cache/</a></p>
<h3 id="-">官网文档</h3>
<p><a href="http://docs.spring.io/spring/docs/3.1.0.M1/spring-framework-reference/html/cache.html" target="_blank">http://docs.spring.io/spring/docs/3.1.0.M1/spring-framework-reference/html/cache.html</a></p>
<h3 id="ehcache-">ehcache介绍</h3>
<p><a href="http://my.oschina.net/coolfire368/blog/123377" target="_blank">http://my.oschina.net/coolfire368/blog/123377</a></p>
<h3 id="spring-mvc-ehcache">spring mvc整合 ehcache</h3>
<p><a href="http://blog.csdn.net/jadyer/article/details/12257865" target="_blank">http://blog.csdn.net/jadyer/article/details/12257865</a></p>
<h3 id="-">简单讲解</h3>
<p>cache主要<em>注解</em>使用：<em>@Cacheable，@CacheEvict，@CachePut</em></p>
<p>缓存是这样的，取值时在方法(A)<em>调用前</em>查一下缓存中是否有目标值，缓存存在的话直接从缓存中拿出<strong>不再去执行方法(A)</strong>,这也是最基本的<em>@Cacheable</em>的概念;</p>
<p>缓存中有值需要更新怎么办？使用@CacheEvict来更新，这个注解的意思是删除掉缓存里面的某个值，从而达到更新缓存的效果。关于缓存更新，例如，取topN个对象，第一次取的时候比如是前1～10个，缓存中存这1～10的<strong>一个集合对象</strong>，第二次取的时候直接从缓存中拿，这没问题，现在是这样的，假设数据库中删除了1～10个元素中的任意一个值，这样<strong>数据库中的topN与缓存中的topN</strong>就不同步了，下次你在前台取topN的时候，因为缓存里面有这个对象，根据之前的介绍（取值时在方法(A)<em>调用前</em>查一下缓存中是否有目标值，缓存存在的话直接从缓存中拿出<strong>不再去执行方法(A)</strong>），方法A被略过，查的值不是真正的topN了，因此需要在add或者delete之后删除掉原来的缓存，保持数据一致。其他情景请自行考虑。</p>
<p>根据缓存的特性，如何做到既要保证方法被调用，又希望结果被缓存呢？直接使用<em>@CachePut</em>，他与@Cacheable的区别就在与方法是会被执行的。</p>
<p>注解里面属性解释,@Cacheable 与@CachePut一样， @CacheEvict还有和删除有关的两个属性：</p>
<ol>
<li><p>value：缓存的名称，在spring配置文件中定义，必须指定至少一个 </p>
<ul>
<li>例如：@Cacheable(value=”mycache”) 或者
@Cacheable(value={”cache1”,”cache2”} </li>
</ul>
</li>
<li><p>key：缓存的key，(缓存是键值对儿)可以为空，如果指定要按照 SpEL 表达式编写，如果不指定，则缺省按照方法的所有参数进行组合 </p>
<ul>
<li>例如：
@Cacheable(value=”testcache”,key=”#userName”)</li>
<li>使用字符串&quot;&#39;sss&#39;&quot;</li>
<li>调用对象getName方法key=”#userName.getName()”</li>
</ul>
</li>
<li><p>condition：缓存的条件，可以为空，使用SpEL 编写，返回 true 或者 false，只有为 true 才进行缓存</p>
<ul>
<li>例如：
@Cacheable(value=”testcache”,condition=”#userName.length()&gt;2”) </li>
</ul>
</li>
<li><p>allEntries:是否清空所有缓存内容，缺省为 false，如果指定为 true，则方法调用后将立即清空<strong>所有</strong>缓存 </p>
<ul>
<li>例如：
@CachEvict(value=”testcache”,allEntries=true)</li>
</ul>
</li>
<li>beforeInvocation:是否在方法执行前就清空，缺省为 false，如果指定为 true，则在<em>*方法还没有执行的时候就清空缓存</em>，缺省情况下为false，这样如果方法执行抛出异常，则不会清空缓存<ul>
<li>例如：
@CachEvict(value=”testcache”，beforeInvocation=true) </li>
</ul>
</li>
</ol>

                
                </section>
            
            </div>

            <div class="page-footer">
    
        
        <div class="navigation-link finished">Finished!</div>
        
    
</div>
        </div>
    </div>
</div>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/ace.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.1.3/mode-javascript.js"></script>
        <script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
        <script src="../gitbook/app.js"></script>
        
    </body>
</html>
